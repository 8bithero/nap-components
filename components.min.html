<html><head><link rel="import" href="bower_components/polymer/polymer.html"><script>function MakePromise(asap){function Promise(fn){if(typeof this!=="object"||typeof fn!=="function")throw new TypeError;this._state=null;this._value=null;this._deferreds=[];doResolve(fn,resolve.bind(this),reject.bind(this))}function handle(deferred){var me=this;if(this._state===null){this._deferreds.push(deferred);return}asap(function(){var cb=me._state?deferred.onFulfilled:deferred.onRejected;if(typeof cb!=="function"){(me._state?deferred.resolve:deferred.reject)(me._value);return}var ret;try{ret=cb(me._value)}catch(e){deferred.reject(e);return}deferred.resolve(ret)})}function resolve(newValue){try{if(newValue===this)throw new TypeError;if(newValue&&(typeof newValue==="object"||typeof newValue==="function")){var then=newValue.then;if(typeof then==="function"){doResolve(then.bind(newValue),resolve.bind(this),reject.bind(this));return}}this._state=true;this._value=newValue;finale.call(this)}catch(e){reject.call(this,e)}}function reject(newValue){this._state=false;this._value=newValue;finale.call(this)}function finale(){for(var i=0,len=this._deferreds.length;i<len;i++){handle.call(this,this._deferreds[i])}this._deferreds=null}function doResolve(fn,onFulfilled,onRejected){var done=false;try{fn(function(value){if(done)return;done=true;onFulfilled(value)},function(reason){if(done)return;done=true;onRejected(reason)})}catch(ex){if(done)return;done=true;onRejected(ex)}}Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)};Promise.prototype.then=function(onFulfilled,onRejected){var me=this;return new Promise(function(resolve,reject){handle.call(me,{onFulfilled:onFulfilled,onRejected:onRejected,resolve:resolve,reject:reject})})};Promise.resolve=function(value){if(value&&typeof value==="object"&&value.constructor===Promise){return value}return new Promise(function(resolve){resolve(value)})};Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})};return Promise}if(typeof module!=="undefined"){module.exports=MakePromise}</script><script>if(!window.Promise){window.Promise=MakePromise(Polymer.Base.async)}</script><script>Polymer({is:"iron-request",properties:{xhr:{type:Object,notify:true,readOnly:true,value:function(){return new XMLHttpRequest}},response:{type:Object,notify:true,readOnly:true,value:function(){return null}},completes:{type:Object,readOnly:true,notify:true,value:function(){return new Promise(function(resolve,reject){this.resolveCompletes=resolve;this.rejectCompletes=reject}.bind(this))}},progress:{type:Object,notify:true,readOnly:true,value:function(){return{}}},aborted:{type:Boolean,notify:true,readOnly:true,value:false}},get succeeded(){var status=this.xhr.status||0;return status===0||status>=200&&status<300},send:function(options){var xhr=this.xhr;if(xhr.readyState>0){return null}xhr.addEventListener("readystatechange",function(){if(xhr.readyState===4&&!this.aborted){if(!this.succeeded){this.rejectCompletes(new Error("The request failed with status code: "+this.xhr.status));return}this._setResponse(this.parseResponse());this.resolveCompletes(this)}}.bind(this));xhr.addEventListener("progress",function(progress){this._setProgress({lengthComputable:progress.lengthComputable,loaded:progress.loaded,total:progress.total})}.bind(this));xhr.addEventListener("error",function(error){this.rejectCompletes(error)}.bind(this));xhr.addEventListener("abort",function(){this.rejectCompletes(new Error("Request aborted."))}.bind(this));xhr.open(options.method||"GET",options.url,options.async!==false);if(options.headers){Object.keys(options.headers).forEach(function(requestHeader){xhr.setRequestHeader(requestHeader,options.headers[requestHeader])},this)}xhr.responseType=xhr._responseType=options.handleAs||"text";xhr.withCredentials=!!options.withCredentials;xhr.send(options.body);return this.completes},parseResponse:function(){var xhr=this.xhr;var responseType=this.xhr.responseType||this.xhr._responseType;var preferResponseText=!this.xhr.responseType;try{switch(responseType){case"json":if(preferResponseText||xhr.response===undefined){try{xhr.responseText}catch(e){return xhr.response}if(xhr.responseText){return JSON.parse(xhr.responseText)}}return xhr.response;case"xml":return xhr.responseXML;case"blob":case"document":case"arraybuffer":return xhr.response;case"text":default:return xhr.responseText}}catch(e){this.rejectCompletes(new Error("Could not parse response. "+e.message))}},abort:function(){this._setAborted(true);this.xhr.abort()}});</script><script>Polymer({is:"iron-ajax",properties:{url:{type:String,value:""},params:{type:Object,value:function(){return{}}},method:{type:String,value:"GET"},headers:{type:Object,value:function(){return{}}},contentType:{type:String,value:"application/x-www-form-urlencoded"},body:{type:String,value:""},sync:{type:Boolean,value:false},handleAs:{type:String,value:"json"},withCredentials:{type:Boolean,value:false},auto:{type:Boolean,value:false},verbose:{type:Boolean,value:false},loading:{type:Boolean,notify:true,readOnly:true},lastRequest:{type:Object,notify:true,readOnly:true},lastResponse:{type:Object,notify:true,readOnly:true},lastError:{type:Object,notify:true,readOnly:true},activeRequests:{type:Array,notify:true,readOnly:true,value:function(){return[]}},debounceDuration:{type:Number,value:0,notify:true},_boundHandleResponse:{type:Function,value:function(){return this._handleResponse.bind(this)}}},observers:["_requestOptionsChanged(url, method, params, headers,"+"contentType, body, sync, handleAs, withCredentials, auto)"],get queryString(){var queryParts=[];var param;var value;for(param in this.params){value=this.params[param];param=window.encodeURIComponent(param);if(value!==null){param+="="+window.encodeURIComponent(value)}queryParts.push(param)}return queryParts.join("&")},get requestUrl(){var queryString=this.queryString;if(queryString){return this.url+"?"+queryString}return this.url},get requestHeaders(){var headers={"Content-Type":this.contentType};var header;if(this.headers instanceof Object){for(header in this.headers){headers[header]=this.headers[header].toString()}}return headers},toRequestOptions:function(){return{url:this.requestUrl,method:this.method,headers:this.requestHeaders,body:this.body,async:!this.sync,handleAs:this.handleAs,withCredentials:this.withCredentials}},generateRequest:function(){var request=document.createElement("iron-request");var requestOptions=this.toRequestOptions();this.activeRequests.push(request);request.completes.then(this._boundHandleResponse).catch(this._handleError.bind(this,request)).then(this._discardRequest.bind(this,request));request.send(requestOptions);this._setLastRequest(request);this._setLoading(true);this.fire("request",{request:request,options:requestOptions});return request},_handleResponse:function(request){this._setLastResponse(request.response);this.fire("response",request)},_handleError:function(request,error){if(this.verbose){console.error(error)}this._setLastError({request:request,error:error});this.fire("error",{request:request,error:error})},_discardRequest:function(request){var requestIndex=this.activeRequests.indexOf(request);if(requestIndex>-1){this.activeRequests.splice(requestIndex,1)}if(this.activeRequests.length===0){this._setLoading(false)}},_requestOptionsChanged:function(){this.debounce("generate-request",function(){if(!this.url&&this.url!==""){return}if(this.auto){this.generateRequest()}},this.debounceDuration)}});</script></head><body><div hidden=""><dom-module id="nap-product"><template><img src="{{_imgUrl(pid)}}/"><div>{{designer}}</div><div>{{description}}</div><div>{{price}}</div></template><script>Polymer({is:"nap-product",properties:{designer:String,pid:String,description:String,price:String},_imgUrl:function(pid){return"//cache.net-a-porter.com/images/products/"+pid+"/"+pid+"_in_sl.jpg"}});</script></dom-module><dom-module id="nap-product-ajax"><template><iron-ajax auto="" url="{{_productUrl(pid)}}" handle-as="json" last-response="{{data}}"></iron-ajax><nap-product pid="{{data.id}}" description="{{data.name}}" price="{{displayPrice(data.price)}}" designer="{{data.brand.name}}"></nap-product></template><script>Polymer({is:"nap-product-ajax",properties:{pid:String},_productUrl:function(pid){return"/demo/pids/"+pid+".json"},displayPrice:function(priceObj){return"Â£"+priceObj.amount/priceObj.divisor}});</script></dom-module><dom-module id="nap-product-list"><style> :host { width: 100%; display:flex; display:-webkit-flex; } nap-product-ajax { display: inline-block; width: 16.66%; } </style><template><iron-ajax auto="" url="/demo/ymal.json" handle-as="json" last-response="{{data}}"></iron-ajax><template is="dom-repeat" items="{{data.ymalPids}}"><nap-product-ajax pid="{{item}}"></nap-product-ajax></template></template><script>Polymer({is:"nap-product-list",properties:{pids:Array}});</script></dom-module></div></body></html>